---
categories: Git
---
# 对于变更的记录

# 基于文件备份的变更记录

`Git`是直接记录快照，**而非**对文件进行差异比较，从而记录差异。

## 其他系统的实现

将它们保存的信息看作是**一组基本文件**和**每个文件随时间逐步累积的差异**。

![](../../img/deltas.png)

上图中的三角形表示差异，其他系统中大多数是记录每个文件在每次版本变更中的**差异**，而非记录文件本身。

## Git的实现

基于备份的实现方式，Git更像是一个小型的**文件系统**。

它主要对当时的**全部文件**制作一个**备份**并保存这个**备份的索引**。 

为了高效，如果文件没有修改，Git不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git对待数据更像是一个**备份流**。

![](../../img/snapshots.png)

# 基于本地计算的高效率

Git几乎所有操作都是在本地执行，这也保证了其高效率。

举个例子，要浏览项目的历史，Git不需外连到服务器去获取历史，然后再显示出来。它只需直接从本地数据库中读取，你能立即看到项目历史（**因为每一个节点对于整个项目的历史都有完整的备份**）。 

如果你想查看当前版本与一个月前的版本之间引入的修改，Git会查找到一个月前的文件做一次本地的差异计算，而不是由远程服务器处理或从远程服务器拉回旧版本文件再来本地处理。

# 对于文件内容的保证

Git 用以计算校验和的机制叫做`SHA-1散列`， 这是一个由40个十六进制字符组成的字符串，基于文件的内容或目录结构计算得出。

它看起来是这样的：

```
24b9da6552252987aa493b52f8696cd6d3b00373
```

Git中使用这种哈希值的情况很多，你将经常看到这种哈希值。

# Git的三种状态

Git有三种状态，文件可能处于其中之一：

- 已提交（Committed）：数据已经安全的保存在本地数据库中。
- 已修改（Modified）：修改了文件，但还没保存到数据库中。
- 已暂存（Staged）：对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中。

## 三个工作区域

![](../../img/areas.png)

- 工作目录：对项目的某个版本独立提取出来的内容。 这些从Git仓库的压缩数据库中提取出来的文件，放在磁盘上供你使用或修改。

  > 通俗来讲，工作目录就是我们平时写代码的地方。                                                                     

- 暂存区域：一个文件，保存了下次将提交的文件列表信息，一般在Git仓库目录中。

  > 暂存区域是.git目录下的index文件，`git add`后的文件都会放在这里。

- 仓库目录：保存项目的**元数据**和**对象数据库**的地方。 这是Git中最重要的部分，从其它计算机克隆仓库时，拷贝的就是这里的数据。

  > 就是隐藏目录.git，这就是Git的版本库。

基本的 Git 工作流程如下：

1. 在工作目录中修改文件。

2. 暂存文件，将文件的快照放入暂存区域。

3. 提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录。

如果Git目录中保存着的特定版本文件，就属于**已提交状态**。 如果作了修改并已放入暂存区域，就属于**已暂存状态**。 如果自上次取出后，作了修改但还没有放到暂存区域，就是**已修改状态**。